# MedianFinder - –ü–æ—à—É–∫ –º–µ–¥—ñ–∞–Ω–∏ –≤ –ø–æ—Ç–æ—Ü—ñ –¥–∞–Ω–∏—Ö

## –©–æ —Ü–µ?

`MedianFinder` - —Ü–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –º–µ–¥—ñ–∞–Ω—É —Å–µ—Ä–µ–¥ —á–∏—Å–µ–ª, —â–æ –ø–æ—Å—Ç—ñ–π–Ω–æ –Ω–∞–¥—Ö–æ–¥—è—Ç—å (–ø–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö).

## –ù–∞–≤—ñ—â–æ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ?

**–ü—Ä–æ–±–ª–µ–º–∞:** –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–≤–∏—á–∞–π–Ω–∏–π —Å–ø–∏—Å–æ–∫ —ñ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è:

```python
numbers = [100, 102, 98]
numbers.sort()  # O(n log n) - –î–û–†–û–ì–û!
median = numbers[len(numbers)//2]

# –î–æ–¥–∞—î–º–æ –Ω–æ–≤–µ —á–∏—Å–ª–æ
numbers.append(105)
numbers.sort()  # O(n log n) - –∑–Ω–æ–≤—É —Å–æ—Ä—Ç—É—î–º–æ –í–°–ï! üò±
```

**–†—ñ—à–µ–Ω–Ω—è –∑ –∫—É–ø–∞–º–∏:** O(log n) –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è, O(1) –¥–ª—è –ø–æ—à—É–∫—É –º–µ–¥—ñ–∞–Ω–∏!

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?

### –û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è: –î–≤—ñ –∫—É–ø–∏

–†–æ–∑–¥—ñ–ª—è—î–º–æ –≤—Å—ñ —á–∏—Å–ª–∞ –Ω–∞ –¥–≤—ñ –ø–æ–ª–æ–≤–∏–Ω–∏:

```
       –ú–µ–Ω—à–∞ –ø–æ–ª–æ–≤–∏–Ω–∞  |  –ë—ñ–ª—å—à–∞ –ø–æ–ª–æ–≤–∏–Ω–∞
       =============== | ================
small (max heap):      | large (min heap):
  [1, 2, 3, 4]         |   [5, 6, 7]
       ‚Üë               |      ‚Üë
   max = 4            |   min = 5
                      |
              –ú–µ–¥—ñ–∞–Ω–∞ = (4 + 5) / 2 = 4.5
```

### –ü—Ä–∞–≤–∏–ª–∞ (—ñ–Ω–≤–∞—Ä—ñ–∞–Ω—Ç–∏):

1. **–ë–∞–ª–∞–Ω—Å —Ä–æ–∑–º—ñ—Ä—ñ–≤:** `len(small) == len(large)` –∞–±–æ `len(small) == len(large) + 1`
2. **–ü–æ—Ä—è–¥–æ–∫:** –í—Å—ñ —á–∏—Å–ª–∞ –≤ `small` ‚â§ –≤—Å—ñ —á–∏—Å–ª–∞ –≤ `large`

### Max Heap –≤ Python

Python –º–∞—î —Ç—ñ–ª—å–∫–∏ **min heap**, –∞–ª–µ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω **max heap**!

**–¢—Ä—é–∫:** –∑–±–µ—Ä—ñ–≥–∞—î–º–æ —á–∏—Å–ª–∞ –∑ –º—ñ–Ω—É—Å–æ–º!

```python
# –•–æ—á–µ–º–æ max heap: [5, 3, 1]
# –ó–±–µ—Ä—ñ–≥–∞—î–º–æ: [-5, -3, -1]
# heapify –¥–∞—î: [-5, -3, -1] (–º—ñ–Ω—ñ–º—É–º = -5)
# –í–µ—Ä—à–∏–Ω–∞ -5 ‚Üí —Ä–µ–∞–ª—å–Ω–µ —á–∏—Å–ª–æ 5 (–º–∞–∫—Å–∏–º—É–º!) ‚úÖ

# –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–∑–∞–¥:
real_number = -heap[0]  # -(-5) = 5
```

## –ê–ª–≥–æ—Ä–∏—Ç–º

### –î–æ–¥–∞–≤–∞–Ω–Ω—è —á–∏—Å–ª–∞ - `add_num(num)`

```python
def add_num(self, num: int):
    # –ö—Ä–æ–∫ 1: –î–æ–¥–∞—î–º–æ –≤ small (–∑ –º—ñ–Ω—É—Å–æ–º –¥–ª—è max heap)
    heapq.heappush(self.small, -num)

    # –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–º—ñ—â—É—î–º–æ –Ω–∞–π–±—ñ–ª—å—à–∏–π –∑ small –≤ large
    heapq.heappush(self.large, -heapq.heappop(self.small))

    # –ö—Ä–æ–∫ 3: –ë–∞–ª–∞–Ω—Å—É—î–º–æ —Ä–æ–∑–º—ñ—Ä–∏ (small –º–∞—î –±—É—Ç–∏ >= large)
    if len(self.small) < len(self.large):
        heapq.heappush(self.small, -heapq.heappop(self.large))
```

**–ü—Ä–∏–∫–ª–∞–¥ –ø–æ–∫—Ä–æ–∫–æ–≤–æ:**

```
–ü–æ—á–∞—Ç–æ–∫: small=[], large=[]

add_num(5):
  1. small=[-5], large=[]
  2. small=[], large=[5]
  3. –ë–∞–ª–∞–Ω—Å: small=[-5], large=[]  ‚Üê –ø–µ—Ä–µ–º—ñ—â—É—î–º–æ –Ω–∞–∑–∞–¥

add_num(15):
  1. small=[-5, -15], large=[]
  2. small=[-5], large=[15]
  3. –ë–∞–ª–∞–Ω—Å: OK (1 == 1)

add_num(1):
  1. small=[-5, -1], large=[15]
  2. small=[-1], large=[5, 15]
  3. –ë–∞–ª–∞–Ω—Å: small=[-5, -1], large=[15]  ‚Üê –ø–µ—Ä–µ–º—ñ—â—É—î–º–æ

–†–µ–∑—É–ª—å—Ç–∞—Ç: small=[-5, -1] (—Ä–µ–∞–ª—å–Ω–æ [1, 5]), large=[15]
```

### –ü–æ—à—É–∫ –º–µ–¥—ñ–∞–Ω–∏ - `find_median()`

```python
def find_median(self) -> float:
    # –í–∏–ø–∞–¥–æ–∫ 1: –ù–µ–ø–∞—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    if len(self.small) > len(self.large):
        return -self.small[0]  # –°–µ—Ä–µ–¥–Ω—ñ–π –µ–ª–µ–º–µ–Ω—Ç —É small

    # –í–∏–ø–∞–¥–æ–∫ 2: –ü–∞—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    return (-self.small[0] + self.large[0]) / 2  # –°–µ—Ä–µ–¥–Ω—î –¥–≤–æ—Ö —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏—Ö
```

**–ß–æ–º—É `heap[0]`, –∞ –Ω–µ `heappop()`?**

```python
# heap[0] - —Ç—ñ–ª—å–∫–∏ –ß–ò–¢–ê–Ñ –≤–µ—Ä—à–∏–Ω—É (–∫—É–ø–∞ –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è)
median1 = mf.find_median()  # ‚úÖ –ü—Ä–∞—Ü—é—î
median2 = mf.find_median()  # ‚úÖ –ü—Ä–∞—Ü—é—î
median3 = mf.find_median()  # ‚úÖ –ü—Ä–∞—Ü—é—î

# heappop() - –í–ò–î–ê–õ–Ø–Ñ –≤–µ—Ä—à–∏–Ω—É (–∫—É–ø–∞ —Ä—É–π–Ω—É—î—Ç—å—Å—è)
median1 = heappop(mf.small)  # üí• –ö—É–ø–∞ –∑–ª–∞–º–∞–Ω–∞!
median2 = heappop(mf.small)  # üí• –Ü–Ω—à—ñ –¥–∞–Ω—ñ!
```

## –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏

### –ù–µ–ø–∞—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å (5 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤):

```
–ß–∏—Å–ª–∞: [1, 2, 3, 4, 5]

small: [1, 2, 3]    large: [4, 5]
         ‚Üë
    max = 3 ‚Üê —Ü–µ –º–µ–¥—ñ–∞–Ω–∞!

–ú–µ–¥—ñ–∞–Ω–∞ = -small[0] = 3
```

### –ü–∞—Ä–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å (6 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤):

```
–ß–∏—Å–ª–∞: [1, 2, 3, 4, 5, 6]

small: [1, 2, 3]    large: [4, 5, 6]
         ‚Üë             ‚Üë
      max = 3       min = 4
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       –ú–µ–¥—ñ–∞–Ω–∞ = (3 + 4) / 2 = 3.5
```

## –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü—ñ—è        | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –ü–æ—è—Å–Ω–µ–Ω–Ω—è                     |
| --------------- | ---------- | ----------------------------- |
| `add_num()`     | O(log n)   | 2-3 –æ–ø–µ—Ä–∞—Ü—ñ—ó heappush/heappop |
| `find_median()` | O(1)       | –ü—Ä–æ—Å—Ç–æ —á–∏—Ç–∞—î–º–æ –≤–µ—Ä—à–∏–Ω–∏        |
| –ü–∞–º'—è—Ç—å         | O(n)       | –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—Å—ñ n —á–∏—Å–µ–ª        |

**–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏:**

| –ú–µ—Ç–æ–¥                    | add_num      | find_median |
| ------------------------ | ------------ | ----------- |
| –°–æ—Ä—Ç–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫        | O(n log n)   | O(1)        |
| **–î–≤—ñ –∫—É–ø–∏ (–Ω–∞—à –º–µ—Ç–æ–¥)** | **O(log n)** | **O(1)**    |
| –ù–µ—Å–æ—Ä—Ç–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫      | O(1)         | O(n log n)  |

## –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

### 1. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ü—ñ–Ω –∞–∫—Ü—ñ–π

```python
mf = MedianFinder()
prices = [100, 102, 98, 105]

for price in prices:
    mf.add_num(price)
    print(f"–¶—ñ–Ω–∞: ${price}, –ú–µ–¥—ñ–∞–Ω–Ω–∞: ${mf.find_median()}")

# –í–∏—Ö—ñ–¥:
# –¶—ñ–Ω–∞: $100, –ú–µ–¥—ñ–∞–Ω–Ω–∞: $100.0
# –¶—ñ–Ω–∞: $102, –ú–µ–¥—ñ–∞–Ω–Ω–∞: $101.0
# –¶—ñ–Ω–∞: $98, –ú–µ–¥—ñ–∞–Ω–Ω–∞: $100.0
# –¶—ñ–Ω–∞: $105, –ú–µ–¥—ñ–∞–Ω–Ω–∞: $101.0
```

### 2. –ß–∞—Å –≤—ñ–¥–≥—É–∫—É —Å–µ—Ä–≤–µ—Ä–∞

```python
mf = MedianFinder()
response_times = [45, 120, 38, 250]

for time in response_times:
    mf.add_num(time)
    median = mf.find_median()
    status = "‚ö†Ô∏è" if median > 100 else "‚úì"
    print(f"{time}–º—Å | –ú–µ–¥—ñ–∞–Ω–∞: {median}–º—Å {status}")
```

## –ö–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏

1. **–î–≤—ñ –∫—É–ø–∏ –∫—Ä–∞—â–µ –∑–∞ –æ–¥–Ω—É** - —Ä–æ–∑–¥—ñ–ª—è—î–º–æ –¥–∞–Ω—ñ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –º–µ–¥—ñ–∞–Ω–∏
2. **Max heap —á–µ—Ä–µ–∑ –º—ñ–Ω—É—Å** - `-num` –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ, `-heap[0]` –ø—Ä–∏ —á–∏—Ç–∞–Ω–Ω—ñ
3. **–ë–∞–ª–∞–Ω—Å –≤–∞–∂–ª–∏–≤–∏–π** - –∑–∞–≤–∂–¥–∏ `len(small) >= len(large)`
4. **`heap[0]` –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è** - `heappop()` —Ä—É–π–Ω—É—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É
5. **–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å** - O(log n) –¥–æ–¥–∞–≤–∞–Ω–Ω—è vs O(n log n) —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è

## –î–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è?

- üìà –§—ñ–Ω–∞–Ω—Å–∏: –º–µ–¥—ñ–∞–Ω–Ω–∞ —Ü—ñ–Ω–∞ –∞–∫—Ü—ñ–π, –º–µ–¥—ñ–∞–Ω–Ω–∏–π –æ–±—Å—è–≥ —Ç–æ—Ä–≥—ñ–≤
- üåê –í–µ–±: –º–µ–¥—ñ–∞–Ω–Ω–∏–π —á–∞—Å –≤—ñ–¥–≥—É–∫—É —Å–µ—Ä–≤–µ—Ä–∞, –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å
- üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞: –º–µ–¥—ñ–∞–Ω–∞ –≤ –ø–æ—Ç–æ—Ü—ñ –º–µ—Ç—Ä–∏–∫ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É
- üéÆ –Ü–≥—Ä–∏: –º–µ–¥—ñ–∞–Ω–Ω–∏–π FPS, —á–∞—Å –≤—ñ–¥–≥—É–∫—É –º–µ—Ä–µ–∂—ñ
- üè• –ú–µ–¥–∏—Ü–∏–Ω–∞: –º–µ–¥—ñ–∞–Ω–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –¥–∞—Ç—á–∏–∫—ñ–≤

## –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏

1. –ú–æ–¥–∏—Ñ—ñ–∫—É–π—Ç–µ –∫–æ–¥ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –Ω–µ –º–µ–¥—ñ–∞–Ω–∏, –∞ 25-–≥–æ –ø–µ—Ä—Å–µ–Ω—Ç–∏–ª—è
2. –î–æ–¥–∞–π—Ç–µ –º–µ—Ç–æ–¥ `remove_num()` –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è —á–∏—Å–µ–ª
3. –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞–Ω–∏ –Ω–µ —á–∏—Å–µ–ª, –∞ –æ–±'—î–∫—Ç—ñ–≤ –∑ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º
