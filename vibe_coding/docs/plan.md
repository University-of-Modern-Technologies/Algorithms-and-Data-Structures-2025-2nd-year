# детальний план розробки Space Invaders

## 1. підготовка проекту

### 1.1 конфігурація і залежності

- [x] Створити `pyproject.toml` з визначенням версій Python 3.12, pygame-ce, pytest, mypy, ruff, black
- [x] Налаштувати `uv` для управління залежностями
- [x] Інітіалізувати структуру каталогів: `src/`, `assets/`, `tests/`, `docs/`, `logs/`
- [x] Створити піддиректорії: `assets/images`, `assets/sounds`, `assets/fonts`, `assets/data`
- [x] Налаштувати PyInstaller конфіг для збірки автономного .exe

### 1.2 інструменти якості

- [x] Конфігурувати `mypy.ini` для типізації
- [x] Налаштувати `ruff.toml` для лінтингу та форматування
- [x] Налаштувати `pytest.ini` для запуску тестів
- [ ] Налаштувати pre-commit хуки для перевірок перед комітом
- [ ] Створити GitHub Actions для CI/CD

### 1.3 структура модулів

- [x] Створити пакет `game.core` для основної логіки гри
- [x] Створити пакет `game.domain` для моделей та бізнес-логіки
- [x] Створити пакет `game.infra` для адаптерів ресурсів, логування, таймінгу
- [x] Створити пакет `game.ui` для інтерфейсу користувача
- [x] Створити точку входу `src/main.py`

---

## 2. інфраструктура і утиліти

### 2.1 система логування

- [x] Реалізувати логер через модуль `infra.logging` з записом у `logs/game.log`
- [x] Налаштувати рівні логування: INFO для основних подій, ERROR для винятків
- [x] Приховувати технічні деталі від користувача, показувати стримані повідомлення

### 2.2 таймінг і ігровий цикл

- [ ] Реалізувати `infra.timing.GameTimer` з фіксованим кроком 60 FPS (dt = 1/60)
- [ ] Реалізувати адаптивний рендеринг (пропуск кадрів при обмеженнях)
- [ ] Реалізувати економію часу сну для стабілізації частоти кадрів
- [ ] Забезпечити детермінізм через обробку команд атомарно

### 2.3 система конфігурації

- [ ] Реалізувати `infra.config.ConfigManager` для читання/запису конфігів
- [ ] Підтримати формат JSON/TOML для налаштувань
- [ ] Зберігати в каталозі користувача: `~/.space_invaders/`
- [ ] Параметри: складність, гучність музики/ефектів, мова, bindings клавіш
- [ ] Функція відновлення до значень за замовчуванням

### 2.4 система локалізації

- [ ] Створити файл перекладу `assets/data/locales.json` з українською та англійською
- [ ] Реалізувати `infra.i18n.Translator` з динамічним перемиканням мови
- [ ] Відокремити всі тексти від коду

### 2.5 система завантаження ресурсів

- [ ] Реалізувати `infra.assets.AssetLoader` для спрайтів, звуків, шрифтів
- [ ] Кешування завантажених ресурсів
- [ ] Обробка помилок при відсутності файлів з fallback'ами

---

## 3. домен-логіка (незалежна від UI)

### 3.1 моделі сутностей

- [x] Клас `domain.entities.Player` з позицією, шириною, HP, щитами
- [x] Клас `domain.entities.Enemy` з типом, позицією, швидкістю, HP
- [x] Клас `domain.entities.Projectile` для снарядів гравця та ворогів
- [x] Клас `domain.entities.Shield` зі станом сегментів
- [x] Клас `domain.entities.BonusShip` для рідкісних бонусних кораблів
- [x] Клас `domain.entities.Wave` для управління хвилями ворогів

### 3.2 система очок

- [ ] Реалізувати `domain.scoring.ScoreManager` з накопленням балів
- [ ] Бали за знищених ворогів: звичайний 10, бонусний корабель 200
- [ ] Зберігання локального рекорду
- [ ] Управління множниками балів за рівнями

### 3.3 управління станом гри

- [x] Enum для станів: MENU, PLAYING, PAUSED, GAME_OVER, SETTINGS
- [x] Клас `domain.game_state.GameState` для глобального стану
- [x] Класи для параметрів складності: EASY, NORMAL, HARD

### 3.4 баланс та параметри

- [x] Таблиця параметрів по рівнях: швидкість ворогів, частота вогню, здоровя
- [x] Масштабування складності через `domain.difficulty.DifficultyParams`
- [ ] Рівняння для зростання швидкості при зменшенні ворогів

---

## 4. ядро гри (core логіка)

### 4.1 система фізики й зіткнень

- [x] Реалізувати `core.physics.CollisionDetector` з AABB (прямокутне) та еліптичною наближеністю
- [x] Методи: `check_rect_rect()`, `check_circle_rect()`, `check_ellipse_circle()`
- [ ] Система команд для обробки зіткнень без дублювання в одному кроці
- [ ] События конфліктів: враг*постріл, гравець*враг, гравець*щит, враг*щит

### 4.2 система вводу

- [ ] Абстракція `core.input.InputHandler` для геймпада і клавіатури
- [ ] Клавіші: стрілки/A-D для руху, пробіл для пострілу, P для паузи, Esc для меню
- [ ] Підтримка геймпада через осі та кнопки pygame
- [ ] Авто-вогонь при триманні пробілу з обмеженням частоти

### 4.3 логіка оновлення

- [ ] Функція `core.update()` як головна точка оновлення логіки
  - Обробка вводу
  - Оновлення позицій (x, y, velocity)
  - Оновлення анімацій (frame counter)
  - Перевірка зіткнень
  - Генерація команд на основі подій
  - Атомарне застосування команд
  - Видалення неживих об'єктів
- [ ] Параметр dt у секундах для фізики незалежної від частоти кадрів

### 4.4 логіка рендерингу

- [ ] Функція `core.render()` для підготовки команд рендерингу
- [ ] Повернення списку об'єктів для рисування у правильному Z-порядку

---

## 5. користувацький інтерфейс

### 5.1 система сцен

- [ ] Базовий клас `ui.scenes.Scene` з методами `update()`, `render()`, `handle_input()`
- [ ] Клас `ui.scenes.MenuScene` - головне меню з кнопками
- [ ] Клас `ui.scenes.GameScene` - основна ігрова сцена
- [ ] Клас `ui.scenes.PauseScene` - екран паузи
- [ ] Клас `ui.scenes.GameOverScene` - підсумок сесії з рекордом
- [ ] Клас `ui.scenes.SettingsScene` - налаштування гри

### 5.2 компоненти UI

- [ ] Базовий `ui.components.Widget` з методами render, update, on_click
- [ ] `ui.components.Button` з текстом, колірною гамою, hover ефектом
- [ ] `ui.components.Label` для статичного тексту
- [ ] `ui.components.Slider` для регуляторів гучності
- [ ] `ui.components.RadioButton` для вибору складності / мови

### 5.3 графіка й анімація

- [ ] Загальний спрайт для гравця, кожного типу ворога, бонусного корабля
- [ ] 2-кадрова анімація для ворогів, змінюється кожен такт руху
- [ ] Короткі анімаційні кліпи для вибухів (3-5 кадрів)
- [ ] Масштабування найближчим сусідом для ретро стилю
- [ ] Підтримка роздільної здатності 1280×720 і 1920×1080

### 5.4 аудіо

- [ ] Звук для пострілу, вибуху, переміщення ворогів
- [ ] Регулятор гучності для музики і ефектів окремо
- [ ] Фоновий трек під час гри (за наявності)

### 5.5 HUD й інформація

- [ ] Лічильник очок в верхньому лівому куту
- [ ] Рекорд сесії в верхньому правому куту
- [ ] Лічильник життів / HP гравця
- [ ] Рівень складності
- [ ] Хвиля ворогів (номер)
- [ ] Підказки керування (в меню)

---

## 6. головна точка входу

### 6.1 main.py

- [ ] Ініціалізація pygame та вікна (1280×720 за замовчуванням)
- [ ] Завантаження конфігурації та локалізації
- [ ] Ініціалізація таймера гри
- [ ] Головний ігровий цикл з фіксованим кроком 60 FPS
- [ ] Безпечна обробка винятків з логуванням
- [ ] Коректне завершення при закриванні вікна

---

## 7. тестування

### 7.1 юніт тести

- [x] Тести для `core.physics.CollisionDetector` (rect-rect, circle-rect, ellipse-circle) — 25/25 пройшли ✅
- [ ] Тести для `core.input.InputHandler` (клавіш та осей)
- [ ] Тести для `domain.scoring.ScoreManager` (додавання балів, рекорди)
- [ ] Тести для `domain.game_state.GameState` (переходи між станами)
- [ ] Тести для `domain.entities` (позиціонування, здоров'я)
- [ ] Тести руху гравця з граничними умовами

### 7.2 інтеграційні тести

- [ ] Тест запуску гри без помилок
- [ ] Тест завантаження ресурсів
- [ ] Тест читання/запису конфігурації
- [ ] Тест ігрового циклу за декілька фреймів

### 7.3 критерії якості

- [ ] Покриття юніт тестами ≥ 60% ігрової логіки
- [ ] Усі публічні функції мають типові анотації
- [ ] Статичний аналіз mypy без помилок
- [ ] Лінтинг ruff без помилок
- [ ] Форматування black без змін
- [ ] Час запуску < 2 сек на типовій машині
- [ ] Час кадру у бойовій сцені < 16 мс (60 FPS)

---

## 8. розгортання і розповсюджування

### 8.1 пакування

- [ ] Скрипт встановлення залежностей через `uv sync`
- [ ] Запуск через `uv run src/main.py`
- [ ] PyInstaller конфіг для збірки .exe на Windows
- [ ] Інструкції для Linux дистрибутивів (pip + venv)

### 8.2 документація

- [ ] README з інструкціями встановлення і запуску
- [ ] Гайд для розробників з описом структури
- [ ] CHANGELOG для версій
- [ ] Жанр та тип проєкту у pyproject.toml

---

## 9. приймальні критерії

- [ ] Запуск гри відкриває головне меню
- [ ] Можна почати нову сесію з вибору складності
- [ ] Гравець рухається рівномірно, обмежений межами екрана
- [ ] Постріли зіштовхуються з ворогами та знищують їх
- [ ] Вороги змінюють швидкість при зменшенні кількості
- [ ] Система балів працює коректно
- [ ] Щити поглинають пошкодження і руйнуються по сегментам
- [ ] Бонусні кораблі іноді пролітають і мають підвищений бал
- [ ] Гра завершується коректно при поразці (враги досягли лінії, HP = 0)
- [ ] Рекорд збирається стабільно і відображається
- [ ] Налаштування застосовуються без перезапуску гри
- [ ] Підтримуються українська та англійська мови

---

## 10. послідовність розробки (рекомендована)

1. **Фаза 0 (Setup)**: Конфіг проекту, структура, інструменти якості
2. **Фаза 1 (Core)**: Фізика зіткнень, система вводу, основна логіка оновлення
3. **Фаза 2 (Domain)**: Моделі сутностей, система очок, управління станом
4. **Фаза 3 (Infra)**: Таймінг, логування, конфіг, локалізація, завантаження ресурсів
5. **Фаза 4 (UI)**: Сцени, компоненти, рендеринг спрайтів, аудіо, HUD
6. **Фаза 5 (Integration)**: Головний цикл, інтеграція всіх модулів
7. **Фаза 6 (Testing & Polish)**: Тести, баланс, оптимізація, розгортання
